<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>로그인 페이지</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" th:href="@{/assets/favicon.ico}" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link th:href="@{/css/styles.css}" rel="stylesheet" />
</head>
<body class="align-middle" >
<div class="container-fluid d-flex justify-content-center" style="height: 100vh">

    <div class="card align-self-center">

        <div class="card-header">
            로그인
        </div>

        <div class="card-body">
            <th:block th:if="${param.logout != null}">
                <h1>Logout.......</h1>
            </th:block>
            <form id="registerForm" action="/templates/member/login" method="post" th:if="${param.logout == null}">
                <div class="input-group mb-3">
                    <span class="input-group-text">아이디</span>
                    <input type="text" name="username" class="form-control" placeholder="이메일 형식입니다.">
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text">패스워드</span>
                    <input type="text" name="password" class="form-control" placeholder="1글자 이상입니다.">
                </div>

                <div class="input-group mb-3">
                    <input class="form-check-input" type="checkbox" name="remember-me">
                    <label class="form-check-label">
                        자동 로그인
                    </label>
                </div>

                <div class="my-4">
                    <div class="float-end">
                        <button type="submit" class="btn btn-primary submitBtn">로그인</button>
                    </div>
                </div>
            </form>

            <!--      이 링크는 OAuth2 Client 라이브러리를 통해서 생성되는 링크이므로 다른 값 사용 X -->
            <div>
                <a href="/oauth2/authorization/kakao">KAKAO</a>
            </div>
            <div>
                <a href="/oauth2/authorization/google">GOOGLE</a>
            </div>
            <div>
                <a href="/oauth2/authorization/naver">NAVER</a>
            </div>

            <a class="nav-link" href="/userRegForm">회원가입</a>
        </div><!--end card body-->
    </div><!--end card-->
</div>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>

    document.querySelector(".submitBtn").addEventListener("click", () => {

        event.preventDefault(); // 기본 폼 제출 방지

        // 사용자 입력값 수집
        const mid = document.querySelector('input[name="username"]').value;
        const mpw = document.querySelector('input[name="password"]').value;

        const data = { mid, mpw }; // axios 전송 데이터 설정

        // 토큰 요청
        axios.post("http://localhost:8080/generateToken", data)
            .then(res => {
                const accessToken = res.data.accessToken;
                const refreshToken = res.data.refreshToken;

                // 로컬 스토리지에 토큰 저장
                localStorage.setItem("accessToken", accessToken);
                localStorage.setItem("refreshToken", refreshToken);

                alert("로그인 성공!");
                window.location.href = "/"; // 원하는 리디렉션 경로
            })
            .catch(error => {
                console.error("로그인 실패:", error);
                alert("로그인 실패! 다시 시도하세요.");
            });
    }, false);

</script>
</body>
</html>